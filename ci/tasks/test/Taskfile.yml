---
version: "3"

includes:
  build:
    taskfile: '../build'
    internal: true
  dev:
    taskfile: '../dev'
    internal: true

tasks:
  unit:
    desc: Run unit tests
    preconditions:
      - sh: which yarn >/dev/null 2>&1
        msg: Missing "yarn". Please install yarn or use the docker container
    deps:
      - dev:install-packages
    cmds:
      - yarn test
    env:
      CI: true
    sources:
      - 'src/**/*.js'
      - 'src/**/*.ts'
      - 'src/**/*.tsx'
      - 'eslint.config.js'
      - 'package.json'
      - 'tsconfig.json'
      - 'vite-config.ts'
  e2e:
    desc: Run end-to-end tests with playwright
    deps:
      - build:build
    cmds:
      - task: e2e-internal
  e2e-ci:
    desc: |
      Run end-to-end tests with playwright without checking deps.
      Not recommended for development
    cmds:
      - task: e2e-internal
  e2e-internal:
    desc: Run end-to-end tests with playwright
    internal: true
    preconditions:
      - sh: which pytest >/dev/null 2>&1
        msg: Missing "pytest". Please install pytest or use the docker container
      - sh: which playwright >/dev/null 2>&1
        msg: Missing "playwright". Please install playwright or use the docker container
    cmds:
      - pytest -s "{{.ROOT_DIR}}/test" {{.CLI_ARGS}}
    env:
      CI: true
      PWDEBUG: '{{if eq .DEBUG "1"}}1{{else}}0{{end}}'
    sources:
      - test/**/*.py
      - test/pytest.ini
    vars:
      DEBUG: '0'
      LOG_ARGS:
