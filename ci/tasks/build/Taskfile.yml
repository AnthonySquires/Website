---
version: "3"

includes:
  dev: 
    taskfile: '../dev'
    internal: true

tasks:
  build:
    desc: Build the production bundle
    preconditions:
      - sh: which yarn >/dev/null 2>&1
        msg: Missing "yarn". Please install yarn or use the docker container
    deps:
      - dev:install-packages
    cmds:
      - yarn build
    generates:
      - dist/**
    sources:
      - 'public/**'
      - 'src/**'
      - 'eslint.config.js'
      - 'index.html'
      - 'package.json'
      - 'tsconfig.json'
      - 'vite-config.ts'
  package:
    desc: Create a production package
    preconditions:
      - sh: which tar >/dev/null 2>&1
        msg: Missing "tar". I don't know how. good luck I guess?
      - sh: which zstd >/dev/null 2>&1
        msg: Missing "zstd". Install it or use docker
    deps:
      - build
    cmds:
      - tar --zstd -C "{{.DIST_DIR}}" -cf "{{.PACKAGE}}" "."
    generates:
      - "{{.PACKAGE}}"
    sources:
      - '{{.DIST_DIR}}/**'
    vars:
      DIST_DIR: "{{.ROOT_DIR}}/dist"
      PACKAGE: "{{.ROOT_DIR}}/website.tar.zst"
